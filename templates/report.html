<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Link Report</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .success { color: green; }
        .fail { color: red; }
        .error { color: orange; }
        li { margin-bottom: 5px; }
    </style>
</head>
<body class="container py-4">
    <h1 class="mb-4">üîó Link Status Report</h1>

    <div class="mb-3">
        <p><strong>Total Links Checked:</strong> {{ total }}</p>
        <p class="text-success">‚úÖ Successful: {{ successful }}</p>
        <p class="text-danger">‚ùå Broken: {{ broken }}</p>
        <p class="text-warning">‚ö†Ô∏è Errors: {{ errors }}</p>
    </div>

    <div class="mb-3">
        <button class="btn btn-secondary btn-sm" onclick="filterLinks('all')">Show All</button>
        <button class="btn btn-success btn-sm" onclick="filterLinks('success')">‚úÖ Passed</button>
        <button class="btn btn-danger btn-sm" onclick="filterLinks('fail')">‚ùå Failed</button>
        <button class="btn btn-warning btn-sm" onclick="filterLinks('error')">‚ö†Ô∏è Errors</button>
        <button class="btn btn-primary btn-sm" onclick="downloadCSV()">‚¨áÔ∏è Download CSV</button>
    </div>

    <ul class="list-group">
        {% for url, status, note in links %}
            <li class="list-group-item {{ 'success' if status == 200 else 'error' if status == 'ERROR' else 'fail' }}">
                <b class="{{ 'text-success' if status == 200 else 'text-warning' if status == 'ERROR' else 'text-danger' }}">
                    {{ status }}
                </b> - <a href="{{ url }}" target="_blank">{{ url }}</a> : {{ note }}
            </li>
        {% endfor %}
    </ul>

    <script>
        function downloadCSV() {
            const csvData = `{{ csv_content | safe }}`;
            const blob = new Blob([csvData], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.setAttribute('hidden', '');
            a.setAttribute('href', url);
            a.setAttribute('download', 'link_report_{{ timestamp }}.csv');
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        function filterLinks(type) {
            const items = document.querySelectorAll('li');
            items.forEach(item => {
                if (type === 'all' || item.classList.contains(type)) {
                    item.style.display = 'list-item';
                } else {
                    item.style.display = 'none';
                }
            });
        }
    </script>
</body>
</html>